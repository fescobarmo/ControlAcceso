# üîê C√≥mo se Conecta GitHub con Docker

## üìã Introducci√≥n

Este documento explica el mecanismo completo de conexi√≥n entre GitHub Actions y los registries de Docker, espec√≠ficamente **GitHub Container Registry (GHCR)**.

**Conceptos clave**:
- Autenticaci√≥n autom√°tica con `GITHUB_TOKEN`
- GitHub Container Registry (ghcr.io)
- Permisos y seguridad
- Flujo completo de login y push

---

## üéØ Tipos de Conexi√≥n

### 1. GitHub Container Registry (GHCR) - ghcr.io

Es el registry **nativo de GitHub**, donde estamos publicando nuestras im√°genes.

#### Autenticaci√≥n Autom√°tica

```yaml
- name: Login a GHCR
  uses: docker/login-action@v3
  with:
    registry: ghcr.io                      # GitHub Container Registry
    username: ${{ github.actor }}           # Tu usuario de GitHub
    password: ${{ secrets.GITHUB_TOKEN }}   # Token autom√°tico
```

#### ¬øC√≥mo funciona?

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  GitHub Actions Runner                                  ‚îÇ
‚îÇ  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  1. Workflow se dispara                                 ‚îÇ
‚îÇ     ‚îî‚îÄ> GitHub genera GITHUB_TOKEN autom√°ticamente     ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  2. docker/login-action@v3 ejecuta                      ‚îÇ
‚îÇ     ‚îî‚îÄ> docker login ghcr.io -u fescobarmo -p <token>  ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  3. Docker guarda credenciales en                       ‚îÇ
‚îÇ     ‚îî‚îÄ> ~/.docker/config.json                          ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  4. docker push puede autenticarse                      ‚îÇ
‚îÇ     ‚îî‚îÄ> Lee ~/.docker/config.json                      ‚îÇ
‚îÇ     ‚îî‚îÄ> Usa token para autenticar con ghcr.io          ‚îÇ
‚îÇ                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîë Variables Clave Explicadas

### `github.actor`

```yaml
username: ${{ github.actor }}
```

**¬øQu√© es?**
- Tu nombre de usuario de GitHub
- En este caso: `fescobarmo`
- GitHub lo proporciona autom√°ticamente en el contexto

**Ejemplo real**:
```yaml
# En el workflow se ve as√≠:
username: ${{ github.actor }}

# GitHub lo convierte a:
username: fescobarmo
```

---

### `secrets.GITHUB_TOKEN`

```yaml
password: ${{ secrets.GITHUB_TOKEN }}
```

**¬øQu√© es?**

Es un **token de autenticaci√≥n temporal** que GitHub genera **autom√°ticamente** para cada workflow run.

**Caracter√≠sticas**:
- ‚úÖ **Autom√°tico**: No necesitas crearlo manualmente
- ‚úÖ **Temporal**: Solo v√°lido durante el workflow run
- ‚úÖ **Seguro**: Se revoca autom√°ticamente al terminar
- ‚úÖ **Con permisos**: Definidos en el workflow

**Ciclo de vida**:
```
Workflow inicia ‚Üí GitHub genera token ‚Üí Token v√°lido ‚Üí Workflow termina ‚Üí Token revocado
                  (autom√°tico)          (1-2 horas)    (autom√°tico)
```

---

### Permisos del GITHUB_TOKEN

En nuestro workflow:
```yaml
permissions:
  contents: read          # Leer c√≥digo del repo
  packages: write         # Escribir en GitHub Packages (GHCR)
  pull-requests: read     # Leer info de PRs
  security-events: write  # Escribir resultados de security scan
```

**¬øQu√© significa `packages: write`?**

```
packages: write
    ^        ^
    |        ‚îî‚îÄ Puede PUSH im√°genes a GHCR
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ GitHub Container Registry = GitHub Packages
```

**Sin** `packages: write`:
```bash
docker push ghcr.io/fescobarmo/controlacceso-backend:latest
# Error: denied: permission_denied: write_package
```

**Con** `packages: write`:
```bash
docker push ghcr.io/fescobarmo/controlacceso-backend:latest
# ‚úÖ The push refers to repository [ghcr.io/fescobarmo/controlacceso-backend]
```

---

## üîÑ Flujo Completo de Conexi√≥n

### Paso a Paso

```
1Ô∏è‚É£  TRIGGER
    ‚îî‚îÄ> git push origin main
         ‚îî‚îÄ> GitHub recibe push
              ‚îî‚îÄ> Dispara workflow docker-build.yml

2Ô∏è‚É£  WORKFLOW INICIA
    ‚îî‚îÄ> GitHub Actions crea runner (VM Ubuntu)
         ‚îî‚îÄ> Genera GITHUB_TOKEN con permisos definidos
              ‚îî‚îÄ> Token: ghp_abc123def456...xyz789

3Ô∏è‚É£  CHECKOUT C√ìDIGO
    ‚îî‚îÄ> actions/checkout@v4
         ‚îî‚îÄ> Clona repo en /home/runner/work/ControlAcceso

4Ô∏è‚É£  SETUP BUILDX
    ‚îî‚îÄ> docker/setup-buildx-action@v3
         ‚îî‚îÄ> Instala Docker Buildx
              ‚îî‚îÄ> buildx version: v0.11.2

5Ô∏è‚É£  LOGIN A GHCR (AQU√ç LA CONEXI√ìN)
    ‚îî‚îÄ> docker/login-action@v3
         ‚îî‚îÄ> registry: ghcr.io
         ‚îî‚îÄ> username: fescobarmo (de github.actor)
         ‚îî‚îÄ> password: ghp_abc123... (de GITHUB_TOKEN)
         
         Ejecuta internamente:
         docker login ghcr.io \
           --username fescobarmo \
           --password-stdin <<< "ghp_abc123..."
         
         Respuesta de ghcr.io:
         ‚úÖ Login Succeeded
         
         Guarda en:
         ~/.docker/config.json
         {
           "auths": {
             "ghcr.io": {
               "auth": "base64(fescobarmo:ghp_abc123...)"
             }
           }
         }

6Ô∏è‚É£  BUILD IMAGEN
    ‚îî‚îÄ> docker/build-push-action@v5
         ‚îî‚îÄ> Construye imagen backend
              ‚îî‚îÄ> Tags: ghcr.io/fescobarmo/controlacceso-backend:latest

7Ô∏è‚É£  PUSH IMAGEN (USA LA CONEXI√ìN)
    ‚îî‚îÄ> docker push ghcr.io/fescobarmo/controlacceso-backend:latest
         ‚îî‚îÄ> Docker lee ~/.docker/config.json
              ‚îî‚îÄ> Encuentra auth para ghcr.io
                   ‚îî‚îÄ> Usa token para autenticar
                        ‚îî‚îÄ> GHCR verifica token con GitHub API
                             ‚îî‚îÄ> GitHub valida: ‚úÖ Token v√°lido + permisos OK
                                  ‚îî‚îÄ> GHCR acepta push
                                       ‚îî‚îÄ> Imagen subida exitosamente

8Ô∏è‚É£  WORKFLOW TERMINA
    ‚îî‚îÄ> GitHub revoca GITHUB_TOKEN
         ‚îî‚îÄ> Token ya no funciona
              ‚îî‚îÄ> Runner se destruye
```

---

## üîê Detalles de Autenticaci√≥n

### ¬øQu√© hace `docker login`?

```bash
docker login ghcr.io -u fescobarmo -p ghp_abc123...
```

#### Proceso interno:

```
1. Docker env√≠a credenciales a ghcr.io
   POST https://ghcr.io/v2/
   Authorization: Basic base64(fescobarmo:ghp_abc123...)

2. GHCR recibe y valida con GitHub API
   GET https://api.github.com/user
   Authorization: Bearer ghp_abc123...
   
   GitHub responde:
   {
     "login": "fescobarmo",
     "id": 12345,
     "permissions": ["packages:write"]
   }

3. GHCR verifica permisos
   ‚úÖ Usuario v√°lido: fescobarmo
   ‚úÖ Token v√°lido: ghp_abc123...
   ‚úÖ Permiso packages:write: S√≠
   
4. GHCR responde a Docker
   200 OK
   {
     "token": "eyJhbGciOiJSUzI1NiIs...",  # Token JWT temporal
     "expires_in": 300                      # 5 minutos
   }

5. Docker guarda token JWT
   ~/.docker/config.json
   
6. Futuros requests usan el JWT
   docker push ‚Üí Usa JWT ‚Üí GHCR acepta
```

---

## üÜö GitHub Container Registry vs Docker Hub

### GHCR (ghcr.io) - Lo que usamos

```yaml
registry: ghcr.io
username: ${{ github.actor }}
password: ${{ secrets.GITHUB_TOKEN }}  # Autom√°tico
```

#### Ventajas

- ‚úÖ Token autom√°tico (GITHUB_TOKEN)
- ‚úÖ Integrado con GitHub
- ‚úÖ Sin configuraci√≥n adicional
- ‚úÖ Mismo billing que GitHub
- ‚úÖ Permisos granulares por repo
- ‚úÖ Gratis para repos p√∫blicos
- ‚úÖ Sin rate limits estrictos

#### Im√°genes resultantes

```
ghcr.io/fescobarmo/controlacceso-backend:latest
ghcr.io/fescobarmo/controlacceso-frontend:latest
ghcr.io/fescobarmo/controlacceso-database:latest
```

---

### Docker Hub (docker.io) - Alternativa

```yaml
registry: docker.io  # o registry.hub.docker.com
username: ${{ secrets.DOCKERHUB_USERNAME }}     # Manual
password: ${{ secrets.DOCKERHUB_TOKEN }}        # Manual
```

#### Requiere configuraci√≥n manual

1. **Crear cuenta en Docker Hub**: https://hub.docker.com
2. **Generar Access Token**: Account Settings ‚Üí Security ‚Üí New Access Token
3. **Agregar secrets en GitHub**:
   - Settings ‚Üí Secrets ‚Üí New repository secret
   - `DOCKERHUB_USERNAME`: tu-usuario
   - `DOCKERHUB_TOKEN`: dckr_pat_abc123...

#### Ventajas

- ‚úÖ M√°s conocido
- ‚úÖ Mayor ecosistema
- ‚úÖ Docker pull por defecto

#### Desventajas

- ‚ùå Requiere configuraci√≥n manual
- ‚ùå Tokens separados
- ‚ùå Rate limits m√°s estrictos
- ‚ùå Pull limits para usuarios an√≥nimos

---

## üìä Comparaci√≥n de Tokens

| Aspecto | GITHUB_TOKEN | Docker Hub Token |
|---------|--------------|------------------|
| **Creaci√≥n** | Autom√°tico | Manual |
| **Duraci√≥n** | Por workflow run | Permanente (hasta revocar) |
| **Scope** | Repo espec√≠fico | Toda la cuenta |
| **Permisos** | Definidos en workflow | Full access o read-only |
| **Revocaci√≥n** | Autom√°tica | Manual |
| **Seguridad** | Alta (temporal) | Media (permanente) |
| **Configuraci√≥n** | 0 pasos | 3+ pasos |

---

## üîç Ver la Conexi√≥n en Acci√≥n

### En GitHub Actions Logs

Cuando ejecutas el workflow, ver√≠as:

```
Run docker/login-action@v3
  with:
    registry: ghcr.io
    username: fescobarmo
    password: ***

Logging in to ghcr.io...
Login Succeeded
```

**Nota**: El password se muestra como `***` por seguridad.

---

### En el C√≥digo del Workflow

```yaml
# Archivo: .github/workflows/docker-build.yml

# Define permisos del GITHUB_TOKEN
permissions:
  packages: write    # ‚Üê Permite push a GHCR

jobs:
  build-backend:
    steps:
      # 1. Login a GHCR
      - name: Login a GHCR
        uses: docker/login-action@v3
        with:
          registry: ghcr.io                    # D√≥nde
          username: ${{ github.actor }}         # Qui√©n (fescobarmo)
          password: ${{ secrets.GITHUB_TOKEN }} # C√≥mo (token auto)
      
      # 2. Build imagen
      - name: Construir y pushear Backend
        uses: docker/build-push-action@v5
        with:
          push: true                           # ‚Üê Usa la conexi√≥n del login
          tags: ghcr.io/fescobarmo/controlacceso-backend:latest
```

---

## üõ°Ô∏è Seguridad

### ¬øPor qu√© es seguro?

```
1. Token temporal
   ‚îî‚îÄ> Solo v√°lido durante el workflow
       ‚îî‚îÄ> Se revoca autom√°ticamente
           ‚îî‚îÄ> No puede usarse despu√©s

2. Permisos m√≠nimos
   ‚îî‚îÄ> Solo packages:write
       ‚îî‚îÄ> No puede modificar c√≥digo
           ‚îî‚îÄ> No puede eliminar repo

3. Scope limitado
   ‚îî‚îÄ> Solo este repo
       ‚îî‚îÄ> No afecta otros repos
           ‚îî‚îÄ> Aislamiento por proyecto

4. Auditado
   ‚îî‚îÄ> Todos los push se registran
       ‚îî‚îÄ> Security ‚Üí Packages
           ‚îî‚îÄ> Trazabilidad completa

5. Sin exposici√≥n
   ‚îî‚îÄ> Token nunca se imprime en logs
       ‚îî‚îÄ> Se muestra como ***
           ‚îî‚îÄ> Imposible de extraer
```

---

### Buenas Pr√°cticas de Seguridad

#### 1. Usar permisos m√≠nimos

```yaml
# ‚úÖ BIEN - Solo lo necesario
permissions:
  contents: read
  packages: write

# ‚ùå MAL - Demasiado permisivo
permissions: write-all
```

---

#### 2. No hardcodear credenciales

```yaml
# ‚ùå MAL - Credenciales en c√≥digo
password: "ghp_abc123def456..."

# ‚úÖ BIEN - Usar secrets
password: ${{ secrets.GITHUB_TOKEN }}
```

---

#### 3. Validar origen del workflow

```yaml
# Solo ejecutar en repo principal
if: github.repository == 'fescobarmo/ControlAcceso'
```

---

## üìç Ubicaci√≥n de las Im√°genes

### En GitHub

Las im√°genes pushadas se ven en:

```
https://github.com/fescobarmo?tab=packages

Packages
‚îú‚îÄ controlacceso-backend
‚îÇ  ‚îú‚îÄ latest (hace 2 horas)
‚îÇ  ‚îú‚îÄ main (hace 2 horas)
‚îÇ  ‚îî‚îÄ main-abc123 (hace 2 horas)
‚îú‚îÄ controlacceso-frontend
‚îÇ  ‚îî‚îÄ ...
‚îî‚îÄ controlacceso-database
   ‚îî‚îÄ ...
```

### Pull de las Im√°genes

#### Repositorio P√∫blico

```bash
# Cualquiera puede hacer pull (repo p√∫blico)
docker pull ghcr.io/fescobarmo/controlacceso-backend:latest

# Sin necesidad de docker login
```

#### Repositorio Privado

```bash
# Necesitar√≠as autenticarte primero
echo $GITHUB_TOKEN | docker login ghcr.io -u fescobarmo --password-stdin
docker pull ghcr.io/fescobarmo/controlacceso-backend:latest
```

---

## üéØ Diagrama de Conexi√≥n Completo

```
GitHub Actions                    GHCR (ghcr.io)                 GitHub API
     ‚îÇ                                 ‚îÇ                              ‚îÇ
     ‚îÇ 1. Genera GITHUB_TOKEN          ‚îÇ                              ‚îÇ
     ‚îÇ    (con packages:write)         ‚îÇ                              ‚îÇ
     ‚îÇ                                 ‚îÇ                              ‚îÇ
     ‚îÇ 2. docker login ghcr.io         ‚îÇ                              ‚îÇ
     ‚îÇ    -u fescobarmo                ‚îÇ                              ‚îÇ
     ‚îÇ    -p <GITHUB_TOKEN>            ‚îÇ                              ‚îÇ
     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                              ‚îÇ
     ‚îÇ                                 ‚îÇ                              ‚îÇ
     ‚îÇ                                 ‚îÇ 3. Valida token              ‚îÇ
     ‚îÇ                                 ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
     ‚îÇ                                 ‚îÇ                              ‚îÇ
     ‚îÇ                                 ‚îÇ 4. Token v√°lido ‚úÖ           ‚îÇ
     ‚îÇ                                 ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
     ‚îÇ                                 ‚îÇ    User: fescobarmo          ‚îÇ
     ‚îÇ                                 ‚îÇ    Perms: packages:write     ‚îÇ
     ‚îÇ                                 ‚îÇ                              ‚îÇ
     ‚îÇ 5. Login Succeeded              ‚îÇ                              ‚îÇ
     ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                              ‚îÇ
     ‚îÇ    Token JWT guardado           ‚îÇ                              ‚îÇ
     ‚îÇ                                 ‚îÇ                              ‚îÇ
     ‚îÇ 6. docker build                 ‚îÇ                              ‚îÇ
     ‚îÇ    (construye imagen)           ‚îÇ                              ‚îÇ
     ‚îÇ                                 ‚îÇ                              ‚îÇ
     ‚îÇ 7. docker push imagen            ‚îÇ                              ‚îÇ
     ‚îÇ    (usa token del login)        ‚îÇ                              ‚îÇ
     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                              ‚îÇ
     ‚îÇ                                 ‚îÇ                              ‚îÇ
     ‚îÇ                                 ‚îÇ 8. Verifica permisos         ‚îÇ
     ‚îÇ                                 ‚îÇ    (usa JWT)                 ‚îÇ
     ‚îÇ                                 ‚îÇ                              ‚îÇ
     ‚îÇ 9. Push exitoso ‚úÖ              ‚îÇ                              ‚îÇ
     ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                              ‚îÇ
     ‚îÇ    Layers uploaded              ‚îÇ                              ‚îÇ
     ‚îÇ                                 ‚îÇ                              ‚îÇ
     ‚îÇ 10. Workflow termina            ‚îÇ                              ‚îÇ
     ‚îÇ     (token se revoca)           ‚îÇ                              ‚îÇ
     ‚îÇ                                 ‚îÇ                              ‚îÇ
```

---

## üíª Ejemplo Completo

### Workflow Completo

```yaml
name: Docker Build and Push

on:
  push:
    branches: [ main ]

# ‚Üê PASO 1: Definir permisos
permissions:
  contents: read      # Leer c√≥digo
  packages: write     # Push a GHCR

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      # ‚Üê PASO 2: Checkout c√≥digo
      - name: Checkout
        uses: actions/checkout@v4
      
      # ‚Üê PASO 3: Setup Buildx
      - name: Setup Docker Buildx
        uses: docker/setup-buildx-action@v3
      
      # ‚Üê PASO 4: LOGIN (LA CONEXI√ìN)
      - name: Login a GHCR
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      
      # ‚Üê PASO 5: Build y Push (usa la conexi√≥n)
      - name: Build and Push
        uses: docker/build-push-action@v5
        with:
          context: ./backend
          push: true
          tags: ghcr.io/${{ github.repository_owner }}/mi-app:latest
```

### Ejecuci√≥n Real

```bash
# Trigger
git push origin main

# GitHub Actions ejecuta:

# 1. Genera token
GITHUB_TOKEN=ghp_abc123def456...xyz789

# 2. Login
docker login ghcr.io -u fescobarmo -p $GITHUB_TOKEN
# Login Succeeded

# 3. Build
docker buildx build --tag ghcr.io/fescobarmo/mi-app:latest ./backend

# 4. Push
docker push ghcr.io/fescobarmo/mi-app:latest
# The push refers to repository [ghcr.io/fescobarmo/mi-app]
# latest: digest: sha256:abc123... size: 1234

# 5. Cleanup
# Token se revoca autom√°ticamente
```

---

## üîß Troubleshooting

### Error: Permission denied

```
Error: denied: permission_denied: write_package
```

**Causa**: Falta permiso `packages: write`

**Soluci√≥n**:
```yaml
permissions:
  packages: write  # ‚Üê Agregar esto
```

---

### Error: Unauthorized

```
Error: unauthorized: authentication required
```

**Causa**: No se ejecut√≥ `docker login` antes de `docker push`

**Soluci√≥n**:
```yaml
# Aseg√∫rate que login est√° ANTES de build-push
- name: Login a GHCR
  uses: docker/login-action@v3
  # ...

- name: Build and Push
  uses: docker/build-push-action@v5
  # ...
```

---

### Error: Invalid credentials

```
Error: Error response from daemon: Get "https://ghcr.io/v2/": invalid credentials
```

**Causa**: Token inv√°lido o expirado

**Soluci√≥n**:
```yaml
# Verificar que usas GITHUB_TOKEN (no otro token)
password: ${{ secrets.GITHUB_TOKEN }}  # ‚Üê Correcto
```

---

## üìö Referencias

- [GitHub Container Registry Docs](https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry)
- [GITHUB_TOKEN Permissions](https://docs.github.com/en/actions/security-guides/automatic-token-authentication)
- [docker/login-action](https://github.com/docker/login-action)
- [docker/build-push-action](https://github.com/docker/build-push-action)

---

## üéâ Resumen

### Puntos Clave

1. **GITHUB_TOKEN**: Generado autom√°ticamente, no necesitas crearlo
2. **ghcr.io**: Registry nativo de GitHub, integraci√≥n perfecta
3. **docker/login-action**: Maneja la autenticaci√≥n por ti
4. **packages: write**: Permiso necesario en el workflow
5. **Temporal**: Token solo v√°lido durante el workflow
6. **Seguro**: Revocaci√≥n autom√°tica al terminar
7. **Sin configuraci√≥n**: Cero pasos manuales requeridos

---

### Flujo Simplificado

```
1. Workflow inicia ‚Üí GitHub genera token
2. Login a GHCR ‚Üí Usa token autom√°tico
3. Build imagen ‚Üí Construye Docker image
4. Push imagen ‚Üí Usa credenciales del login
5. Workflow termina ‚Üí Token revocado
```

---

### Ventajas de GHCR

‚úÖ **Autom√°tico**: Sin configuraci√≥n manual  
‚úÖ **Seguro**: Tokens temporales y revocados  
‚úÖ **Integrado**: Parte del ecosistema GitHub  
‚úÖ **Gratuito**: Para repos p√∫blicos  
‚úÖ **R√°pido**: Infraestructura optimizada  

---

**¬øPreguntas sobre la conexi√≥n GitHub-Docker?** Consulta este documento o los logs de GitHub Actions. üöÄ

